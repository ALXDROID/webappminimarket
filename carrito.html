<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Carrito ‚Ä¢ MiniMarket</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body {
    background: #f2f2f2;
    font-family: 'Arial Rounded MT', sans-serif;
  }

  /* HEADER */
  .top-banner {
    background: linear-gradient(135deg, #00b894, #019874);
    padding: 30px 20px;
    color: white;
    border-bottom-left-radius: 25px;
    border-bottom-right-radius: 25px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    position: relative;
  }

  .banner-title {
    font-size: 26px;
    font-weight: bold;
  }

  .btn-dark-mode {
    position: absolute;
    top: 15px;
    right: 15px;
  }

  /* ITEM CARRITO */
  .cart-item {
    background: white;
    border-radius: 15px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.12);
  }

  .cart-img {
    width: 90px;
    height: 90px;
    border-radius: 10px;
    object-fit: cover;
  }

  .qty-btn {
    background: #00b894;
    color: white;
    border: none;
    width: 35px;
    height: 35px;
    border-radius: 8px;
    font-size: 20px;
  }

  .delete-btn {
    background: #e74c3c;
    border: none;
    border-radius: 8px;
    width: 35px;
    height: 35px;
    color: white;
  }

  /* TOTAL */
  .total-box {
    background: white;
    padding: 20px;
    border-radius: 18px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.12);
  }

  /* DARK MODE */
  body.dark {
    background: #1e1e1e;
    color: #eee;
  }

  .dark .cart-item,
  .dark .total-box {
    background: #2b2b2b;
    box-shadow: 0 0 15px rgba(255,255,255,0.05);
  }

  .dark .top-banner {
    background: linear-gradient(135deg, #222, #111);
  }

</style>

</head>
<body>

<!-- HEADER -->
<div class="top-banner mb-4">
  <button onclick="toggleDark()" 
          class="btn btn-light btn-sm btn-dark-mode">üåô</button>

  <div class="banner-title">üõç Tu Carrito</div>
  <div>Revisa tu pedido antes de continuar</div>
</div>

<div class="container mb-4">
  <div id="listaCarrito"></div>
</div>

<!-- TOTAL -->
<div class="container mb-5">
  <div class="total-box">
    <h4>Total a pagar:</h4>
    <h2 id="total" class="text-success fw-bold">$0</h2>

    <button onclick="enviarPedido()" class="btn btn-success w-100 py-3 fs-5 mt-3">
      Confirmar Pedido üî•
    </button>
  </div>
</div>

<script src="app.js"></script>

<script>
// -------------------------
// MOSTRAR CARRITO PRO
// -------------------------
function mostrarCarritoPro() {
  const div = document.getElementById("listaCarrito");
  div.innerHTML = "";

  let carrito = obtenerCarrito();
  let total = 0;

  carrito.forEach(item => {
    let p = productos.find(x => x.id === item.id);
    let subtotal = p.precio * item.cantidad;
    total += subtotal;

    div.innerHTML += `
      <div class="cart-item d-flex gap-3 align-items-center">
        <img src="${p.img}" class="cart-img">

        <div class="flex-grow-1">
          <h6 class="fw-bold mb-1">${p.nombre}</h6>
          <p class="m-0 text-success fw-bold">$${subtotal}</p>

          <div class="d-flex gap-2 mt-2">
            <button class="qty-btn" onclick="restar(${p.id})">‚àí</button>
            <span class="fw-bold fs-5">${item.cantidad}</span>
            <button class="qty-btn" onclick="sumar(${p.id})">+</button>
          </div>
        </div>

        <button class="delete-btn" onclick="eliminar(${p.id})">‚úï</button>
      </div>
    `;
  });

  // Total
  document.getElementById("total").textContent = "$" + total;
}

// -------------------------
// SUMAR
// -------------------------
function sumar(id) {
  let carrito = obtenerCarrito();
  let item = carrito.find(x => x.id === id);
  item.cantidad++;
  guardarCarrito(carrito);
  mostrarCarritoPro();
}

// -------------------------
// RESTAR
// -------------------------
function restar(id) {
  let carrito = obtenerCarrito();
  let item = carrito.find(x => x.id === id);

  if (item.cantidad > 1) {
    item.cantidad--;
  } else {
    carrito = carrito.filter(x => x.id !== id);
  }

  guardarCarrito(carrito);
  mostrarCarritoPro();
}

// -------------------------
// ELIMINAR
// -------------------------
function eliminar(id) {
  let carrito = obtenerCarrito().filter(x => x.id !== id);
  guardarCarrito(carrito);
  mostrarCarritoPro();
}

// -------------------------
// ENVIAR PEDIDO
// -------------------------
function enviarPedido() {
  const tipo = localStorage.getItem("tipoPedido") || "retiro";
  alert("Pedido enviado (" + tipo + ")");
    let total = document.getElementById("total").textContent.replace("$","");
  let hist = JSON.parse(localStorage.getItem("historial") || "[]");

  hist.push({
    fecha: new Date().toLocaleString(),
    total
  });

  localStorage.setItem("historial", JSON.stringify(hist));
  alert("Pedido registrado üéâ");
}

// -------------------------
// DARK MODE
// -------------------------
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("darkmode", document.body.classList.contains("dark"));
}
if (localStorage.getItem("darkmode") === "true") {
  document.body.classList.add("dark");
}

// cargar carrito al entrar
mostrarCarritoPro();
</script>

</body>
</html>
