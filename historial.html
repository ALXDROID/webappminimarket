<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Historial</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
.card-pedido {
  border-radius: 15px;
  padding: 15px;
  background: white;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
.badge-estado {
  font-size: 14px;
  padding: 6px 10px;
  border-radius: 8px;
}
</style>

</head>

<body class="p-3">

<h2 class="mb-3">ðŸ“¦ Historial de Pedidos</h2>

<div id="hist" class="mt-3">Cargando...</div>

<script>
// Obtener usuario logueado
const usuario = JSON.parse(localStorage.getItem("usuario") || "null");
if (!usuario) {
  alert("Debes iniciar sesiÃ³n.");
  location.href = "login.html";
}

// -------- Cargar historial desde backend --------
async function cargarHistorial() {
  try {
    const res = await fetch("https://marketApp.kesug.com/api/historialPedidos.php", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ id_usuario: usuario.id })
    });

    const data = await res.json();

    if (!data.success) {
      document.getElementById("hist").innerHTML = "Error al cargar historial.";
      return;
    }

    mostrarPedidos(data.pedidos);

  } catch (e) {
    document.getElementById("hist").innerHTML = "Error de conexiÃ³n.";
  }
}

// -------- Renderizar pedidos --------
function mostrarPedidos(lista){
  if (lista.length === 0) {
    document.getElementById("hist").innerHTML = `
      <p class="text-muted">AÃºn no has realizado pedidos.</p>
    `;
    return;
  }

  let html = "";
  lista.forEach(p => {

    let badge = "";
    if (p.estado === "pendiente") badge = `<span class="badge bg-warning text-dark badge-estado">Pendiente</span>`;
    if (p.estado === "preparando") badge = `<span class="badge bg-primary badge-estado">Preparando</span>`;
    if (p.estado === "listo") badge = `<span class="badge bg-success badge-estado">Listo</span>`;

    html += `
      <div class="card-pedido mb-3">
        <h5>Pedido #${p.id}</h5>
        <div class="d-flex justify-content-between">
          <span>Total: <strong>$${p.total}</strong></span>
          ${badge}
        </div>
        <small class="text-muted">${p.fecha}</small>
      </div>
    `;
  });

  document.getElementById("hist").innerHTML = html;
}

// Iniciar
cargarHistorial();
</script>

</body>
</html>
