<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Detalle ‚Ä¢ MiniMarket</title>

<link href="bootstrap.min.css" rel="stylesheet">

<style>
body {
  background: #f2f2f2;
  font-family: 'Arial Rounded MT', sans-serif;
}

/* IMAGEN SUPERIOR */
.top-img {
  width: 100%;
  height: 260px;
  object-fit: cover;
  border-bottom-left-radius: 25px;
  border-bottom-right-radius: 25px;
}

/* CAJA DESCRIPTIVA */
.desc-box {
  margin-top: -20px;
  background: white;
  border-radius: 20px;
  padding: 20px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.15);
}

.btn-add {
  background: #00b894;
  color: white;
  border-radius: 10px;
  font-size: 22px;
  padding: 12px;
  width: 100%;
}

.fav-btn {
  font-size: 32px;
  background: none;
  border: none;
  cursor: pointer;
  transition: transform .1s;
}

.fav-btn:hover {
  transform: scale(1.1);
}

/* DARK MODE */
body.dark {
  background: #1e1e1e;
  color: #eee;
}

.dark .desc-box {
  background: #2b2b2b;
  box-shadow: 0 0 15px rgba(255,255,255,0.07);
}

.dark .btn-secondary {
  background: #333 !important;
  border-color: #555;
  color: #eee !important;
}
</style>
</head>

<body>

<div id="detalle" class="p-3 text-center">Cargando...</div>

<script src="app.js"></script>

<script>
document.addEventListener("DOMContentLoaded", async () => {

  // Forzar modo oscuro si qued√≥ activado
  if (localStorage.getItem("darkmode") === "true") {
    document.body.classList.add("dark");
  }

  // ---------------------------
  // 1. Cargar productos del backend
  // ---------------------------
  await cargarProductos();

  // ---------------------------
  // 2. Obtener ID desde URL
  // ---------------------------
  const cont = document.getElementById("detalle");
  const id = new URLSearchParams(location.search).get("id");

  if (!id) {
    cont.innerHTML = `
      <div class="p-4 text-center">
        <h2>‚ùå Par√°metros inv√°lidos</h2>
        <button onclick="location.href='index.html'" class="btn btn-success mt-3">
          Volver al inicio
        </button>
      </div>`;
    return;
  }

  // ---------------------------
  // 3. Buscar producto
  // ---------------------------
  const p = productos.find(x => x.id == id);

  if (!p) {
    cont.innerHTML = `
      <div class="p-4 text-center">
        <h2>‚ùå Producto no encontrado</h2>
        <p class="text-muted">Es posible que ya no est√© disponible.</p>
        <button onclick="location.href='index.html'" class="btn btn-success mt-3">
          Volver al inicio
        </button>
      </div>`;
    return;
  }

  // ---------------------------
  // 4. Favorito SI / NO
  // ---------------------------
  const favoritos = obtenerFavs();
  const esFav = favoritos.includes(p.id);

  const iconoFav = esFav ? "‚ù§Ô∏è" : "ü§ç";

  // ---------------------------
  // 5. Construir vista final
  // ---------------------------
  cont.innerHTML = `
    <img src="${p.img}" class="top-img">

    <div class="desc-box">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h3 class="m-0">${p.nombre}</h3>
        <button class="fav-btn" onclick="toggleFav(${p.id}); recargarFav(${p.id});">
          ${iconoFav}
        </button>
      </div>

      <h2 class="text-success fw-bold">$${p.precio}</h2>
      <p class="text-muted">Producto seleccionado del MiniMarket.</p>

      <button onclick="agregar(${p.id})" class="btn-add mt-3">
        A√±adir al carrito üõí
      </button>

      <button onclick="history.back()" class="btn btn-secondary w-100 mt-3">
        Volver
      </button>
    </div>
  `;
});

// -------------------------------------------
// ACTUALIZAR ICONO DE FAVORITO SIN REFRESCAR PANTALLA
// -------------------------------------------
function recargarFav(id) {
  const favoritos = obtenerFavs();
  const btn = document.querySelector(".fav-btn");
  btn.innerHTML = favoritos.includes(id) ? "‚ù§Ô∏è" : "ü§ç";
}
</script>

</body>
</html>
